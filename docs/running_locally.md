# Running uAssign locally

Running uAssign locally requires docker (of course), and docker-compose.
So far, uAssign has only been tested running on *NIX systems, and should
work as expected on both Linux and OS X.


## Local server

First, configure the environment variables by populating `.env` in the root
directory of your clone of this repository:

```
UA_DEBUG=true
UA_DATABASE=postgres://postgres:mysecretpassword@localhost:5432/postgres?sslmode=disable
UA_AES_KEY=<KEY HERE>
UA_DISABLE_LIMITS=true
DC_ASSIGNMENT_PATH=/home/jake/pl/ua-cs126/assignments
```

This enables debug logging, postgres info for a local container, no limits on
containers, as well as the path to the assignments. `DC_ASSIGNMENT_PATH` sets
the path on the host to the assignments directory, which will be mounted as a
volume.

`UA_AES_KEY` is a base64 encoded 128-bit AES key used for spec encryption
between PL, the client, and uAssign. This key is known to PL and the uAssign
server. One can be generated by doing:

```
$ openssl rand -base64 16
```

Once `.env` is populated, run `docker-compose`:

```
$ docker-compose up
```

This starts both the database and the uAssign server, and will quit on an
interrupt. The HTTP server is available at port 8000.


## Local PrairieLearn

PrairieLearn is used as usual, however, the uAssign aspects need some
modification to point to a local server. In your course's PrairieLearn content
repository's `elements/uassign_terminal/uassign_terminal.py`'s render
function, force:

```python
host = 'localhost:8000'
insecure = True
```

And in `serverFilesCourse/uassign.py`'s clean_spec function, replace the URL, like:

```python
req = Request('http://localhost:8000/spec/clean')
```

Now, PrairieLearn will contact the local server. Be sure to not commit these
changes with the rest of your updates.

As shown in [prairielearn.md](prairielearn.md), it's possible to set these
variables in the element itself, however it's easier to set these globally
than to change every question.